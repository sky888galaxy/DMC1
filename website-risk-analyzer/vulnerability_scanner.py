import requests
import re


# 漏洞检测函数
def detect_vulnerabilities(webpage_code):
    vulnerabilities = []

    # 检查 SQL 注入
    if "select * from" in webpage_code or "union select" in webpage_code:
        vulnerabilities.append("可能存在 SQL 注入漏洞")

    # 检查 XSS 漏洞
    if "<script>" in webpage_code or "eval(" in webpage_code:
        vulnerabilities.append("可能存在 XSS 漏洞")

    return vulnerabilities


# 网站源码爬取函数
def fetch_website_code(url):
    try:
        response = requests.get(url)
        response.raise_for_status()  # 如果状态码不是 200，抛出异常
        return response.text
    except requests.exceptions.RequestException as e:
        print(f"爬取网站 {url} 时发生错误: {e}")
        return None


# 示例主函数，演示漏洞扫描
def scan_website_for_vulnerabilities(url):
    # 爬取网站源码
    webpage_code = fetch_website_code(url)
    if not webpage_code:
        return {"error": "无法爬取该网站"}

    # 检测漏洞
    vulnerabilities = detect_vulnerabilities(webpage_code)

    # 返回检测结果
    return {"url": url, "vulnerabilities": vulnerabilities}


# 测试漏洞检测
if __name__ == "__main__":
    url = "https://example.com"  # 替换为你想测试的网站URL
    result = scan_website_for_vulnerabilities(url)
    print(result)
